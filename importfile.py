import glob
import re
import json
import xlwt


#加载文件路径
def load_files_from_dir(dir,mysheet,a):
    files = glob.glob(dir)
    result = []
    for file in files:
        with open(file, 'r') as load_f:
           b = 0
           load_dict = json.load(load_f)
           #mysheet.write(a, 0, label='%s' % load_dict['entityId'])
           #mysheet.write(a, 1, label='%s' % load_dict['entityType'])
           #mysheet.write(a, 2, label='%s' % load_dict['event'])
           #mysheet.write(a, 3, label='%s' % load_dict['eventTime'])
           cdict=[]
           cdict = load_dict['properties']
           for key in cdict:
               #print(a,b,key)
               mysheet.write(a, b, label='%s'%key)
               b = b + 1
        with open(file) as f:
           lines = f.readline()
           lines_to_line = "".join(lines)
           lines_to_line = re.sub(r"[APT1|Crypto|Locker|Zeus]",' ',lines_to_line,flags = re.I)
           #print(lines_to_line)
           a=a+1
           result.append(lines_to_line)
    #print("数据数目：",num)
    return result,a



#加载文件
def load_files(mysheet,a):
    malware_class = ['APT1','Crypto','Locker','Zeus']
    x = []
    y = []
    for i,family in enumerate(malware_class):
       dir = r'F:\ProgramAnalysis\MalwareTrainingSets_master\trainingSets\%s\*'%family
       print("Load files from %s" % dir)
       v,a = load_files_from_dir(dir,mysheet,a)
       x+=v
       y+=[i]*len(v)
    return x,y


if __name__ == '__main__':
    excel = xlwt.Workbook(encoding='ascii')
    mysheet = excel.add_sheet('sheet1')
    a = 0
    load_files(mysheet,a)
    excel.save(r'C:\Users\Bitter\Desktop\propertiesinput.xls')
